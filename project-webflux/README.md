# Spring WebFlux

Why was Spring WebFlux created?

Part of the answer is the need for a non-blocking web stack to handle concurrency 
with a small number of threads and scale with fewer hardware resources.

**How to Compile**

You can compile the project only by running the `mvnw` command line script.

On *nix environment you may run the `mvnw` shell script,
```bash
./mvnw clean install
```

On Windows environment you may run the `mvnw.cmd` command.
```bash
mvnw.cmd clean install
```

**How to Native Compile**

You can compile this Spring WebFlux application to a native executable.

In order compile to native executable, you need to install the Graalvm and `native-image` command.

You can use SdkMan to install and configure JDKs.

```
# install sdkman
curl -s "https://get.sdkman.io" | bash

# initialize sdkman on the current shell session
source "$HOME/.sdkman/bin/sdkman-init.sh"

# install Graalvm Java 11
sdk install java 21.1.0.r11-grl

# install native image tool
gu install native-image
```

This command will create a native executable under the `target` folder.
```
mvn -Pnative -DskipTests package
```

**How to Run**

You'll need a PostgreSQL instance with some data in it. You can use the `postgres-docker-compose.yml` file under the `docker-compose` folder.

First you need to run the docker-compose on the `postgres-docker-compose.yml` file, it should create a PostgreSQL instance with the necessary `city` table and data. 

```
cd ../docker-compose
docker-compose -f postgres-docker-compose.yml up
```

## Test Results

The following are the measurements on memory, cpu and avarage response times for `project-webflux` as Java and Native compiled Java application with the `go-postgresql-rest` application as the Go application, `express-js` as the Node app, `micronaut-rest-r2db` as the Micronaut app, `php-pg-rest` as the PHP app, `python-pg-rest` as the python app, `FatJarPG` as the vanilla java application.

The average startup time for the Java application is 2.5 seconds, after compiling to native the average is around 90ms, similar to the Go application.

Here is the `ab` command used in the test, first 1000 requests are discarded.
```
for i in {1..100}; do ab -n 500 -c 20 "http://localhost:8080/city" ; sleep 1; done
```

### The Average Response Times
Java, Native compiled Java and other results. The FarJar app tested twice with a -Xmx512MB and an -Xmx128MB parameter.

| Percent | SpringBoot | Native SpringBoot | Go     | Node   | Micronaut | Micronaut Native | PHP 5.4 | PHP 8.1.0beta1 | Python/Flask | Fatjar 512MB | Fatjar 128MB |
| ------- | ---------- | ----------------- | ------ | ------ | --------- | ---------------- | ------- | -------------- | ------------ | ------------ | ------------ |
| 50%     | 265.75     | 615.5             | 138.25 | 237.75 | 540.75    | 938              | 399.75  | 231.5          | 211.5        | 84.5         | 159.75       |
| 66%     | 298.25     | 655.25            | 171    | 255.25 | 738.5     | 1269.5           | 400.25  | 233.25         | 226.75       | 108          | 191.5        |
| 75%     | 320.5      | 697.75            | 189.75 | 270.25 | 865.75    | 1537.75          | 401.25  | 234            | 235.75       | 122.25       | 215          |
| 80%     | 334.25     | 725.5             | 201    | 284.25 | 962.75    | 1739.25          | 401.5   | 234.25         | 241.5        | 132.25       | 231.5        |
| 90%     | 378.25     | 784.75            | 234.75 | 333.75 | 1344.25   | 2557             | 403     | 235.75         | 264.75       | 155          | 273.75       |
| 95%     | 412.25     | 850               | 262.75 | 375.5  | 1676.75   | 3714.25          | 404.5   | 237.25         | 305.5        | 178          | 314.5        |
| 98%     | 458.25     | 934               | 298    | 430.75 | 2023      | 6578.75          | 406.75  | 239.5          | 337.5        | 206.75       | 370.5        |
| 99%     | 480.25     | 982               | 354    | 473    | 2168.5    | 8616.75          | 409     | 239.75         | 358          | 226.5        | 402.75       |
| 100%    | 534.5      | 1073.5            | 467.75 | 547.75 | 2398      | 8441.75          | 410.25  | 240.5          | 408.5        | 276.5        | 482          |


### Average Response Time(s)

Average response times of the applications.
![Average Repsonse Times](images/average-response-times.png "Average Repsonse Times")


Native compiled java applications performances.
![Native Compiled Java Average Repsonse Time](images/average-response-time-native-compiled-java.png "Native Compiled Java Average Repsonse Time")



### The Memory Percentages
Java, Native compiled Java and other application results.
These values are of 16GB of memory, therefore;
* 5,5 percent approximately equals to **900MB** (Java Spring WebFlux)
* 4,5 percent approximately equals to **737MB** (Native compiled Spring WebFlux)
* 0.25 percent approximately equals to **40MB** (Go App)
* 0.55 percent approximately equals to **90MB** (Node App)
* 5 percent approximately equals to **820MB** (Micronaut Java)
* 4 percent approximately equals to **655MB** (Micronaut Native)
* 0.08 percent approximately equals to **13MB** (PHP 5.4)
* 0.11 percent approximately equals to **18MB** (PHP 8.1.0beta1)
* 0,34 percent approximately equals to **56MB** (Python)
* 5,5 percent approximately equals to **900MB** (FatJar 512MB)
* 3 percent approximately equals to **490MB** (FarJar 128MB)

| SpringBoot | Native SpringBoot | GO   | Node | Micronaut | Native Micronaut | PHP 5.4 | PHP 8.1.0beta1 | Python/Flask | FatJar 512MB | FatJar 128MB |
| ---------- | ----------------- | ---- | ---- | --------- | ---------------- | ------- | -------------- | ------------ | ------------ | ------------ |
| 5.37       | 3.39              | 0.21 | 0.5  | 4.9       | 1.78             | 0.09    | 0.11           | 0.33         | 5.79         | 1.54         |
| 5.39       | 3.56              | 0.22 | 0.56 | 4.9       | 2.8              | 0.07    | 0.11           | 0.33         | 5.79         | 1.78         |
| 5.4        | 3.76              | 0.23 | 0.56 | 4.9       | 2.88             | 0.08    | 0.11           | 0.33         | 5.79         | 1.78         |
| 5.4        | 3.92              | 0.23 | 0.56 | 4.9       | 2.92             | 0.1     | 0.11           | 0.33         | 5.79         | 1.77         |
| 5.41       | 4.16              | 0.23 | 0.57 | 4.92      | 2.96             | 0.07    | 0.11           | 0.34         | 5.79         | 1.89         |
| 5.41       | 4.32              | 0.23 | 0.57 | 4.92      | 3                | 0.07    | 0.11           | 0.34         | 5.79         | 1.89         |
| 5.42       | 4.49              | 0.24 | 0.53 | 4.93      | 3.08             | 0.09    | 0.11           | 0.34         | 5.79         | 1.91         |
| 5.43       | 4.5               | 0.24 | 0.6  | 4.94      | 3.14             | 0.08    | 0.11           | 0.33         | 5.79         | 2.82         |
| 5.44       | 4.54              | 0.24 | 0.51 | 4.94      | 3.19             | 0.1     | 0.11           | 0.33         | 5.02         | 2.86         |
| 5.44       | 4.5               | 0.24 | 0.56 | 4.94      | 3.28             | 0.07    | 0.11           | 0.33         | 5.26         | 3.07         |
| 5.44       | 4.54              | 0.24 | 0.59 | 4.94      | 3.33             | 0.07    | 0.11           | 0.33         | 5.27         | 3.1          |
| 5.45       | 4.5               | 0.24 | 0.57 | 4.95      | 3.37             | 0.07    | 0.11           | 0.33         | 5.3          | 3.19         |
| 5.45       | 4.54              | 0.24 | 0.6  | 4.95      | 3.41             | 0.07    | 0.11           | 0.36         | 5.48         | 3.19         |
| 5.46       | 4.5               | 0.24 | 0.56 | 4.95      | 3.52             | 0.07    | 0.11           | 0.33         | 5.5          | 3.06         |
| 5.46       | 4.53              | 0.24 | 0.64 | 4.95      | 3.56             | 0.1     | 0.11           | 0.33         | 5.61         | 3.11         |
| 5.47       | 4.48              | 0.24 | 0.58 | 4.96      | 3.59             | 0.1     | 0.11           | 0.34         | 5.63         | 2.97         |
| 5.48       | 4.49              | 0.24 | 0.55 | 4.96      | 3.68             | 0.08    | 0.11           | 0.34         | 5.73         | 3.18         |
| 5.48       | 4.5               | 0.24 | 0.57 | 4.96      | 3.73             | 0.1     | 0.11           | 0.33         | 5.8          | 2.79         |
| 5.48       | 4.47              | 0.24 | 0.58 | 4.96      | 3.78             | 0.09    | 0.11           | 0.32         | 4.46         | 3.17         |
| 5.48       | 4.51              | 0.24 | 0.64 | 4.96      | 3.87             | 0.1     | 0.11           | 0.33         | 5.43         | 3.17         |
| 5.49       | 4.54              | 0.24 | 0.58 | 4.96      | 3.91             | 0.1     | 0.11           | 0.33         | 5.43         | 3.16         |
| 5.51       | 4.51              | 0.24 | 0.48 | 4.97      | 3.96             | 0.07    | 0.11           | 0.34         | 5.59         | 3.12         |
| 5.51       | 4.55              | 0.24 | 0.53 | 4.97      | 4                | 0.07    | 0.11           | 0.33         | 5.81         | 3.22         |
| 5.52       | 4.5               | 0.24 | 0.56 | 4.97      | 4.11             | 0.07    | 0.11           | 0.33         | 5.81         | 3.22         |
| 5.52       | 4.54              | 0.24 | 0.53 | 4.97      | 4.14             | 0.07    | 0.11           | 0.33         | 5.81         | 3.21         |
| 5.52       | 4.5               | 0.24 | 0.56 | 4.98      | 4.19             | 0.07    | 0.11           | 0.34         | 3.18         | 3.2          |
| 5.52       | 4.53              | 0.24 | 0.57 | 4.98      | 4.28             | 0.07    | 0.11           | 0.34         | 5.27         | 3.13         |
| 5.53       | 4.49              | 0.24 | 0.54 | 4.98      | 4.32             | 0.07    | 0.11           | 0.34         | 5.27         | 3.22         |
| 5.53       | 4.53              | 0.24 | 0.56 | 4.98      | 4.33             | 0.07    | 0.11           | 0.33         | 5.48         | 3.2          |
| 5.55       | 4.49              | 0.24 | 0.68 | 4.98      | 4.35             | 0.07    | 0.11           | 0.34         | 5.52         | 3.22         |
| 5.57       | 4.52              | 0.24 | 0.6  | 4.99      | 4.36             | 0.07    | 0.11           | 0.33         | 5.53         | 3.11         |
| 5.57       | 4.49              | 0.24 | 0.57 | 4.99      | 4.36             | 0.1     | 0.11           | 0.35         | 5.58         | 3.18         |
| 5.59       | 4.55              | 0.24 | 0.51 | 4.99      | 4.36             | 0.07    | 0.11           | 0.34         | 5.77         | 3.07         |
| 5.59       | 4.51              | 0.24 | 0.56 | 4.99      | 4.36             | 0.07    | 0.11           | 0.34         | 5.84         | 3.22         |
| 5.59       | 4.55              | 0.24 | 0.63 | 4.99      | 4.36             | 0.07    | 0.11           | 0.36         | 5.84         | 3.14         |
| 5.6        | 4.51              | 0.24 | 0.53 | 4.99      | 4.36             | 0.07    | 0.11           | 0.34         | 5.84         | 3.12         |
| 5.6        | 4.55              | 0.24 | 0.57 | 4.99      | 4.36             | 0.08    | 0.11           | 0.33         | 5.25         | 3.19         |
| 5.6        | 4.51              | 0.24 | 0.56 | 4.99      | 4.36             | 0.1     | 0.11           | 0.36         | 5.64         | 3.23         |
| 5.6        | 4.54              | 0.24 | 0.58 | 4.99      | 4.36             | 0.1     | 0.11           | 0.34         | 5.65         | 3.14         |
| 5.6        | 4.49              | 0.25 | 0.61 | 4.99      | 4.36             | 0.1     | 0.11           | 0.34         | 5.69         | 3.22         |
| 5.61       | 4.54              | 0.25 | 0.61 | 4.99      | 4.36             | 0.1     | 0.11           | 0.34         | 5.82         | 3.16         |
| 5.61       | 4.5               | 0.25 | 0.56 | 4.99      | 4.34             | 0.07    | 0.11           | 0.34         | 5.84         | 3.1          |
| 5.61       | 4.53              | 0.25 | 0.53 | 5.01      | 4.36             | 0.08    | 0.11           | 0.34         | 5.86         | 3.2          |
| 5.61       | 4.49              | 0.25 | 0.58 | 5.01      | 4.36             | 0.07    | 0.11           | 0.34         | 5.86         | 2.85         |
| 5.61       | 4.53              | 0.25 | 0.54 | 5.01      | 4.36             | 0.09    | 0.11           | 0.33         | 5.86         | 3.21         |
| 5.61       | 4.48              | 0.25 | 0.57 | 5.01      | 4.36             | 0.1     | 0.11           | 0.34         | 5.86         | 3.06         |
| 5.63       | 4.51              | 0.25 | 0.59 | 5.01      | 4.36             | 0.1     | 0.11           | 0.37         | 3.75         | 3.23         |
| 5.63       | 4.48              | 0.25 | 0.6  | 5.01      | 4.36             | 0.07    | 0.11           | 0.33         | 5.14         | 3.24         |
| 5.63       | 4.52              | 0.25 | 0.67 | 5.02      | 4.35             | 0.07    | 0.11           | 0.33         | 5.26         | 3.22         |
| 5.63       | 4.54              | 0.25 | 0.57 | 5.02      | 4.35             | 0.09    | 0.11           | 0.34         | 5.65         | 3.22         |
| 5.64       | 4.54              | 0.25 | 0.5  | 5.02      | 4.35             | 0.08    | 0.11           | 0.36         | 5.86         | 3.23         |
| 5.64       | 4.51              | 0.25 | 0.5  | 5.02      | 4.35             | 0.07    | 0.11           | 0.36         | 5.86         | 3.23         |
| 5.64       | 4.54              | 0.25 | 0.5  | 5.02      | 4.35             | 0.07    | 0.11           | 0.35         | 5.86         | 3.22         |
| 5.65       | 4.5               | 0.25 | 0.25 | 5.04      | 4.35             | 0.08    | 0.11           | 0.34         | 5.87         | 3.19         |
| 5.65       | 4.53              | 0.25 | 0.24 | 5.04      | 4.35             | 0.07    | 0.11           | 0.33         | 5.87         | 3.22         |
| 5.65       | 4.5               | 0.25 | 0.57 | 5.04      | 4.35             | 0.09    | 0.11           | 0.34         | 5.87         | 3.09         |
| 5.65       | 4.52              | 0.25 | 0.5  | 5.04      | 4.35             | 0.07    | 0.11           | 0.35         | 5.87         | 3.24         |
| 5.65       | 4.48              | 0.25 | 0.5  | 5.04      | 4.35             | 0.07    | 0.11           | 0.36         | 5.18         | 3.19         |
| 5.65       | 4.52              | 0.25 | 0.5  | 5.04      | 4.35             | 0.07    | 0.11           | 0.34         | 5.31         | 3.25         |
| 5.65       | 4.48              | 0.25 | 0.25 | 5.04      | 4.32             | 0.07    | 0.11           | 0.33         | 5.53         | 3.24         |
| 5.65       | 4.52              | 0.25 | 0.53 | 5.04      | 4.35             | 0.1     | 0.11           | 0.33         | 5.61         | 3.24         |
| 5.65       | 4.48              | 0.25 | 0.58 | 5.05      | 4.35             | 0.09    | 0.11           | 0.34         | 5.61         | 3.15         |

![Memory Percentages](images/memory-percentages.png "Memory Percentages")



### The CPU Percentages
Java, Native compiled Java and other application results.

| SpringBoot | Native SpringBoot | Go  | Node | Micronaut | Native Micronaut | PHP 5.4 | PHP 8.1.0beta1 | Python/Flask | FatJar 512MB | FatJar 128MB |
| ---------- | ----------------- | --- | ---- | --------- | ---------------- | ------- | -------------- | ------------ | ------------ | ------------ |
| 1          | 100               | 94  | 44   | 100       | 5                | 45      | 14             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 22               | 70      | 49             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 76               | 70      | 49             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 49             | 100          | 18           | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 69      | 49             | 100          | 100          | 100          |
| 100        | 100               | 42  | 100  | 100       | 100              | 70      | 49             | 37           | 100          | 100          |
| 100        | 100               | 100 | 98   | 100       | 100              | 70      | 26             | 73           | 100          | 66           |
| 100        | 100               | 100 | 20   | 100       | 100              | 70      | 22             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 50             | 100          | 100          | 100          |
| 78         | 100               | 100 | 100  | 100       | 100              | 70      | 48             | 100          | 100          | 100          |
| 100        | 100               | 57  | 100  | 100       | 100              | 24      | 49             | 100          | 35           | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 43      | 49             | 72           | 100          | 13           |
| 100        | 100               | 100 | 100  | 100       | 100              | 69      | 49             | 38           | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 17             | 100          | 100          | 100          |
| 100        | 100               | 100 | 13   | 100       | 100              | 70      | 32             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 69      | 49             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 48             | 100          | 100          | 58           |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 49             | 100          | 69           | 100          |
| 16         | 100               | 100 | 100  | 100       | 100              | 69      | 49             | 1            | 100          | 100          |
| 100        | 100               | 56  | 100  | 100       | 100              | 70      | 48             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 71      | 9              | 100          | 100          | 100          |
| 100        | 100               | 100 | 45   | 100       | 100              | 26      | 40             | 100          | 100          | 100          |
| 100        | 100               | 100 | 67   | 100       | 100              | 42      | 48             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 48             | 100          | 100          | 100          |
| 100        | 100               | 30  | 100  | 100       | 100              | 69      | 49             | 21           | 82           | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 71      | 49             | 84           | 100          | 100          |
| 24         | 100               | 100 | 100  | 100       | 100              | 70      | 47             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 1              | 100          | 100          | 100          |
| 100        | 100               | 100 | 84   | 100       | 100              | 69      | 47             | 100          | 100          | 100          |
| 100        | 100               | 90  | 37   | 100       | 100              | 71      | 49             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 68      | 48             | 53           | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 71      | 49             | 56           | 37           | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 29      | 50             | 100          | 100          | 38           |
| 100        | 100               | 93  | 100  | 100       | 100              | 37      | 36             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 11             | 100          | 62           | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 49             | 100          | 100          | 100          |
| 100        | 100               | 100 | 8    | 37        | 100              | 70      | 47             | 85           | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 50             | 28           | 100          | 28           |
| 100        | 100               | 33  | 100  | 100       | 57               | 70      | 49             | 100          | 40           | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 48             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 25             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 23             | 100          | 87           | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 49             | 100          | 100          | 97           |
| 100        | 100               | 47  | 14   | 100       | 100              | 31      | 48             | 8.91         | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 37      | 50             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 69      | 48             | 100          | 89           | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 49             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 69      | 15             | 100          | 100          | 100          |
| 100        | 57                | 100 | 100  | 100       | 100              | 70      | 33             | 100          | 80           | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 50             | 39           | 100          | 100          |
| 100        | 100               | 100 | 8    | 100       | 100              | 69      | 49             | 71           | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 71      | 49             | 100          | 100          | 100          |
| 100        | 100               | 83  | 100  | 100       | 100              | 70      | 49             | 100          | 95           | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 50             | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 51        | 100              | 33      | 9              | 100          | 100          | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 35      | 38             | 81           | 19           | 100          |
| 100        | 100               | 100 | 100  | 100       | 100              | 71      | 50             | 30           | 100          | 100          |
| 100        | 100               | 30  | 14   | 100       | 100              | 70      | 49             | 100          | 100          | 100          |
| 88         | 100               | 100 | 100  | 100       | 100              | 70      | 49             | 100          | 100          | 84           |
| 100        | 100               | 100 | 100  | 100       | 100              | 70      | 48             | 100          | 78           | 100          |
| 81         | 100               | 100 | 100  | 100       | 100              | 70      | 51             | 100          | 100          | 100          |

![CPU Percentages](images/cpu-percentages.png "CPU Percentages")




